version: '2'

networks:
    code-review-network:
        driver: bridge

services:

    couchdb:
        image: couchdb:1.6.1
        restart: always
        networks:
            - code-review-network
        ports:
            - "5984:5984"              # altere no codereview.config.js também
        environment:
            - COUCHDB_USER=root        # altere no codereview.config.js também
            - COUCHDB_PASSWORD=pass    # altere no codereview.config.js também
        volumes:
            - ./couchdb/data:/usr/local/var/lib/couchdb



    back-end:
        build:  ./back-end-node
        restart: always
        networks:
            - code-review-network
        ports:
            - "8093:3000"
        links:
            - couchdb
        volumes:
            - ./config:/opt/simplereview-backend/config

    front-end:
        build: ./front-end
        restart: always
        networks:
            - code-review-network
        ports:
            - "5000:5000"



    srv-codereview:
        build: ./nginx
        restart: always
        networks:
            - code-review-network
        ports:
            - "80:80"
                
    # Adicionar como webhook:
    # http://git/sti/sagas2/settings/integrations
    # http://srv-codereview/back-end-review/rpc/webhook
    #
    # Dispare manualmente usando $ curl -X POST http://srv-codereview/back-end-review/rpc/webhook
    #
    git:
        image: gitlab/gitlab-ce
        networks:
            - code-review-network
        ports:
            - "8090:80"
        logging:
            driver: none
